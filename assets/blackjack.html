<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blackjack - Python Casino</title>
<style>
:root {
  --bg: #0c0f14;
  --card: #151a22;
  --accent: #00d4ff;
  --accent-2: #8a2be2;
  --text: #e8eef6;
  --muted: #9aa7b2;
}

html, body {
  height: 100%;
}

body {
  margin: 0;
  font-family: system-ui, "Segoe UI", Roboto, sans-serif;
  background: radial-gradient(1200px 800px at 20% 10%, rgba(138,43,226,.25), transparent 60%), radial-gradient(1000px 700px at 80% 90%, rgba(0,212,255,.2), transparent 60%), var(--bg);
  color: var(--text);
}

.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 40px;
  background: rgba(255,255,255,.03);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,.08);
}

.logo {
  font-size: 22px;
  font-weight: 600;
  color: var(--accent);
}

.balance {
  font-size: 16px;
  color: var(--muted);
}

.game-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 80vh;
  padding: 40px 20px;
}

.game-table {
  width: 100%;
  max-width: 800px;
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 16px;
  backdrop-filter: blur(6px);
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
  padding: 30px;
  margin-bottom: 20px;
}

.bet-controls {
  display: flex;
  align-items: center;
  gap: 20px;
  justify-content: center;
  margin-bottom: 30px;
}

.bet-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.bet-amount {
  font-size: 24px;
  font-weight: 600;
  color: var(--accent);
  background: rgba(255,255,255,.06);
  padding: 10px 20px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.12);
  min-width: 120px;
  text-align: center;
}

.bet-buttons {
  display: flex;
  gap: 8px;
}

.btn {
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  color: #0a0f14;
  cursor: pointer;
  transition: transform .06s ease, box-shadow .2s ease;
  font-size: 14px;
}

.btn-small {
  padding: 6px 12px;
  font-size: 12px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--accent), #4de2ff);
  box-shadow: 0 4px 12px rgba(0,212,255,.35);
}

.btn-secondary {
  background: linear-gradient(135deg, var(--accent-2), #b07cff);
  box-shadow: 0 4px 12px rgba(138,43,226,.35);
}

.btn-danger {
  background: linear-gradient(135deg, #ff4757, #ff6b7a);
  box-shadow: 0 4px 12px rgba(255,71,87,.35);
}

.btn:hover {
  transform: translateY(-1px);
}

.btn:active {
  transform: translateY(0);
}

.game-area {
  display: flex;
  flex-direction: column;
  gap: 30px;
  margin-bottom: 30px;
}

.player-area, .dealer-area {
  text-align: center;
}

.area-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 15px;
  color: var(--accent);
}

.cards {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 15px;
}

.card {
  width: 60px;
  height: 84px;
  background: rgba(255,255,255,.1);
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 600;
}

.game-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
  margin-bottom: 20px;
}

.back-button {
    display: flex;
    justify-content: left;
    align-items: left;
    padding: 20px;
}

.footer {
  margin-top: 20px;
  color: var(--muted);
  font-size: 13px;
  text-align: center;
}
</style>
</head>

<body>
<nav class="navbar">
  <div class="logo">Blackjack</div>
  <div class="balance">Welcome, {{ username }} | Balance: ${{ "%.2f"|format(balance) }} | <a href="/logout" style="color: var(--accent); text-decoration: none;">Logout</a></div>
</nav>

<div class="back-button">
  <button class="btn btn-secondary btn-small" onclick="window.location.href='/lobby'">← Back to Lobby</button>
</div>

<div class="game-container">
  <div class="game-table">
    <!-- Bet Controls -->
    <div class="bet-controls">
      <div class="bet-display">
        <div style="font-size: 14px; color: var(--muted); margin-bottom: 5px;">Bet Amount</div>
        <div class="bet-amount" id="betAmount">$100</div>
        <div class="bet-buttons">
          <button class="btn btn-primary btn-small" onclick="changeBet(-100)">-100</button>
          <button class="btn btn-primary btn-small" onclick="changeBet(100)">+100</button>
        </div>
      </div>
    </div>

    <!-- Game Areas -->
    <div class="game-area">
      <div class="dealer-area">
        <div class="area-title">Dealer</div>
        <div class="cards" id="dealerCards">
          <!-- Cards will be displayed here -->
        </div>
        <div style="font-size: 14px; color: var(--muted);">Total: <span id="dealerTotal">0</span></div>
      </div>

      <div class="player-area">
        <div class="area-title">Your Cards</div>
        <div class="cards" id="playerCards">
          <!-- Cards will be displayed here -->
        </div>
        <div style="font-size: 14px; color: var(--muted);">Total: <span id="playerTotal">0</span></div>
      </div>
    </div>

    <!-- Game Buttons -->
    <div class="game-buttons">
      <button class="btn btn-primary" id="dealBtn" onclick="dealCards()">Deal Cards</button>
      <button class="btn btn-secondary" id="hitBtn" onclick="hit()" style="display: none;">Hit</button>
      <button class="btn btn-danger" id="standBtn" onclick="stand()" style="display: none;">Stand</button>
      <button class="btn btn-secondary" id="newGameBtn" onclick="newGame()" style="display: none;">New Game</button>
    </div>

    <!-- Game Status -->
    <div style="text-align: center; margin-top: 20px; font-size: 16px; font-weight: 600;" id="gameStatus">
      Place your bet and click "Deal Cards" to start!
    </div>
  </div>
</div>

<div class="footer">
  Copyright © 2025 Python Casino. All rights reserved.
</div>

<script>
let currentBet = 100;
let gameStarted = false;
let playerCards = [];
let dealerCards = [];
let playerTotal = 0;
let dealerTotal = 0;

// Minimum bet is 100
const MIN_BET = 100;

function updateBetDisplay() {
  document.getElementById('betAmount').textContent = '$' + currentBet;
}

function changeBet(amount) {
  const newBet = currentBet + amount;
  if (newBet >= MIN_BET) {
    currentBet = newBet;
    updateBetDisplay();
  }
}

async function dealCards() {
  if (gameStarted) return;
  
  try {
    const response = await fetch('/api/blackjack/deal', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ bet_amount: currentBet })
    });
    
    const result = await response.json();
    
    if (result.ok) {
      gameStarted = true;
      playerCards = result.player_cards;
      dealerCards = result.dealer_cards;
      playerTotal = result.player_total;
      dealerTotal = result.dealer_total;
      
      updateCardsDisplay();
      updateButtons();
      updateGameStatus('Game in progress! Hit or Stand?');
      updateBalance(result.new_balance);
    } else {
      alert('Error: ' + result.error);
    }
  } catch (error) {
    alert('Error: ' + error.message);
  }
}

async function hit() {
  if (!gameStarted) return;
  
  try {
    const response = await fetch('/api/blackjack/hit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    });
    
    const result = await response.json();
    
    if (result.ok) {
      playerCards = result.player_cards;
      dealerCards = result.dealer_cards;
      playerTotal = result.player_total;
      dealerTotal = result.dealer_total;
      
      updateCardsDisplay();
      
      if (result.game_over) {
        if (result.result === 'bust') {
          updateGameStatus('Bust! You lose $' + currentBet);
        }
        endGame();
      }
    } else {
      alert('Error: ' + result.error);
    }
  } catch (error) {
    alert('Error: ' + error.message);
  }
}

async function stand() {
  if (!gameStarted) return;
  
  try {
    const response = await fetch('/api/blackjack/stand', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    });
    
    const result = await response.json();
    
    if (result.ok) {
      playerCards = result.player_cards;
      dealerCards = result.dealer_cards;
      playerTotal = result.player_total;
      dealerTotal = result.dealer_total;
      
      updateCardsDisplay();
      updateBalance(result.new_balance);
      
      // Show result
      let message = '';
      switch(result.game_result) {
        case 'win':
          message = 'You win $' + result.bet + '!';
          break;
        case 'lose':
          message = 'You lose $' + result.bet;
          break;
        case 'tie':
          message = 'Push! Your bet is returned.';
          break;
        default:
          message = 'Game ended.';
      }
      
      updateGameStatus(message);
      endGame();
    } else {
      alert('Error: ' + result.error);
    }
  } catch (error) {
    alert('Error: ' + error.message);
  }
}

function newGame() {
  gameStarted = false;
  playerCards = [];
  dealerCards = [];
  playerTotal = 0;
  dealerTotal = 0;
  updateCardsDisplay();
  updateButtons();
  updateGameStatus('Place your bet and click "Deal Cards" to start!');
}

function updateCardsDisplay() {
  document.getElementById('playerCards').innerHTML = playerCards.map(card => 
    `<div class="card">${card}</div>`
  ).join('');
  
  document.getElementById('dealerCards').innerHTML = dealerCards.map(card => 
    `<div class="card">${card}</div>`
  ).join('');
  
  document.getElementById('playerTotal').textContent = playerTotal;
  document.getElementById('dealerTotal').textContent = dealerTotal;
}

function updateButtons() {
  const dealBtn = document.getElementById('dealBtn');
  const hitBtn = document.getElementById('hitBtn');
  const standBtn = document.getElementById('standBtn');
  const newGameBtn = document.getElementById('newGameBtn');
  
  if (!gameStarted) {
    dealBtn.style.display = 'inline-block';
    hitBtn.style.display = 'none';
    standBtn.style.display = 'none';
    newGameBtn.style.display = 'none';
  } else {
    dealBtn.style.display = 'none';
    hitBtn.style.display = 'inline-block';
    standBtn.style.display = 'inline-block';
    newGameBtn.style.display = 'none';
  }
}

function updateGameStatus(message) {
  document.getElementById('gameStatus').textContent = message;
}

function updateBalance(newBalance) {
  // Update the balance in the navbar
  const balanceElement = document.querySelector('.balance');
  const username = balanceElement.textContent.split('|')[0].trim();
  balanceElement.innerHTML = `${username} | Balance: $${newBalance.toFixed(2)} | <a href="/logout" style="color: var(--accent); text-decoration: none;">Logout</a>`;
}

function endGame() {
  document.getElementById('hitBtn').style.display = 'none';
  document.getElementById('standBtn').style.display = 'none';
  document.getElementById('newGameBtn').style.display = 'inline-block';
}

// Initialize
updateBetDisplay();
</script>
</body>
</html>